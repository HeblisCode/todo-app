(()=>{"use strict";const e=function(){const e={};function t(t){return void 0!==e[t]||(console.log(`PubSub says: "${t}" hasn't been published yet!`),!1)}return{subscribe:function(t,n){void 0===e[t]&&(e[t]=[]),e[t].push(n),console.log(e)},unsubscribe:function(n,i){if(!t(n)||!function(t,n){return!(e[t].indexOf(n)<0&&(console.log("PubSub says: no such handler found"),1))}(n,i))return;const s=e[n].indexOf(i);e[n].splice(s,1),console.log(e)},publish:function(n,i){t(n)&&e[n].forEach((e=>e(i)))}}}(),t=(e,t)=>{const n={name:e,date:t,isDone:!1,id:`taskID${Math.floor(999999*Math.random())}`},i={done(){this.isDone=!0},notDone(){this.isDone=!1},edit(e,t){this.name=e,this.date=t}};return Object.assign(Object.create(i),n)},n=(e,n,i)=>{const s={title:e,description:n,priority:i,completed:!1,id:`projID${Math.floor(999999*Math.random())}`,tasks:[t("test","domani"),t("test2","dopo domani")]},d={pushTask(e){this.tasks.push(e)},deleteTask(e){const t=this.tasks.indexOf(e);this.tasks.splice(t,1)},edit(e,t,n){this.title=e,this.description=t,this.priority=n},getTasks(){return this.tasks},checkCompleted(){const e=tasks.sort((e=>e.isDone));tasks.lenght===e.lenght&&(this.completed=!0)}};return Object.assign(Object.create(d),s)},i=function(){const t=[];function i(e){for(let n=0;n<t.length;n++)if(t[n].id===e)return n}function s(e,t){for(let n=0;n<e.tasks.length;n++)if(e.tasks[n].id===t)return n}return e.subscribe("deleteProject",(function(n){const s=i(n);t.splice(s,1),e.publish("todoDataChanged",t)})),e.subscribe("deleteTask",(function(n){const d=s(n.project,n.id),a=i(n.project.id);t[a].tasks.splice(d,1),e.publish("todoDataChanged",t)})),e.subscribe("completeTask",(function(n){const d=i(n.projId),a=s(t[d],n.taskId);t[d].tasks[a].done(),e.publish("todoDataChanged",t)})),e.subscribe("incompleteTask",(function(n){const d=i(n.projId),a=s(t[d],n.taskId);t[d].tasks[a].notDone(),e.publish("todoDataChanged",t)})),e.subscribe("editProject",(function(n){const s=i(n.projId);t[s].edit(n.title,n.description,n.priority),e.publish("todoDataChanged",t)})),{addProject:function(i,s,d){const a=n(i,s,d);t.push(a),e.publish("todoDataChanged",t)}}}();!function(){const t=document.querySelector("nav"),n=document.querySelector("#navProjectsContainer"),i=document.querySelector("main"),s=document.querySelector("header > button"),d=document.querySelector("#addProject"),a=document.querySelector("nav > form"),c={data:null,set(e){this.data=e},get(){return this.data}};function o(t){if(!t)return;i.innerHTML="";const n=function(e){const t=document.createElement("div"),n=document.createElement("h2"),i=document.createElement("div"),s=document.createElement("span"),d=document.createElement("span");return t.id="mainHeader",i.id="mainButtons",s.classList.add("material-icons"),d.classList.add("material-icons"),n.innerText=e.title,s.innerText="delete",d.innerText="edit",i.appendChild(s),i.appendChild(d),t.appendChild(n),t.appendChild(i),t}(t),s=function(t){const n=document.createElement("div"),i=document.createElement("h3"),s=document.createElement("p");return n.id="mainDescription",i.innerText="Description",""===t.description?s.innerText="Write your description here!":s.innerText=t.description,s.addEventListener("click",(()=>{e.publish("requestDescriptionEdit",function(t){const n=document.createElement("form"),i=document.createElement("textarea"),s=document.createElement("span"),d=document.createElement("span");return i.setAttribute("type","text"),i.innerText=t.description,n.setAttribute("method","dialog"),s.classList.add("material-icons"),d.classList.add("material-icons"),s.innerText="done",d.innerText="cancel",s.addEventListener("click",(()=>{e.publish("editProject",{projId:t.id,title:t.title,description:i.value,priority:t.value})})),d.addEventListener("click",(()=>{e.publish("editProject",{projId:t.id,title:t.title,description:t.description,priority:t.value})})),n.appendChild(i),n.appendChild(s),n.appendChild(d),n}(t))})),n.appendChild(i),n.appendChild(s),n}(t),d=function(t){const n=document.createElement("div"),i=document.createElement("h3"),s=document.createElement("div");return n.id="mainTasks",i.innerText="Tasks",s.id="tasksContainer",s.classList.add("taskContainer"),s.innerHTML="",t.tasks.forEach((n=>{s.appendChild(function(t,n){const i=document.createElement("div"),s=document.createElement("div"),d=document.createElement("p"),a=document.createElement("p"),c=document.createElement("span"),o=document.createElement("span");return i.classList.add("task"),s.classList.add("taskContent"),d.classList.add("taskTitle"),a.classList.add("taskDate"),c.classList.add("material-icons"),o.classList.add("material-icons"),n.isDone?(i.classList.add("taskCompleted"),o.innerText="close",o.addEventListener("click",(()=>{e.publish("incompleteTask",{projId:t.id,taskId:n.id})}))):(o.innerText="done",i.classList.remove("taskCompleted"),o.addEventListener("click",(()=>{e.publish("completeTask",{projId:t.id,taskId:n.id})}))),c.addEventListener("click",(()=>{e.publish("deleteTask",{project:t,id:n.id})})),d.innerText=n.name,a.innerText=n.date,c.innerText="delete",s.appendChild(d),s.appendChild(a),i.appendChild(o),i.appendChild(s),i.appendChild(c),i}(t,n))})),n.appendChild(i),n.appendChild(s),n}(t);i.appendChild(n),i.appendChild(s),i.appendChild(d)}s.addEventListener("click",(()=>{t.classList.toggle("navBarActive")})),d.addEventListener("click",(()=>{a.classList.add("formActive")})),e.subscribe("todoDataChanged",(function(t){!function(t){n.innerHTML="",t.forEach((t=>{const i=function(t,n){const i=document.createElement("div"),s=document.createElement("p"),d=document.createElement("span");return i.classList.add("projectNav"),s.classList.add("projectNavTitle"),d.classList.add("material-icons"),d.addEventListener("click",(()=>{e.publish("deleteProject",t.id)})),n&&n.id===t.id&&i.classList.add("projectNavActive"),i.addEventListener("click",(()=>{!function(){const e=document.querySelector(".projectNavActive");null!==e&&e.classList.remove("projectNavActive")}(),i.classList.add("projectNavActive"),e.publish("currentProjectChanged",t)})),s.innerText=t.title,d.innerText="delete",i.id=t.id,i.appendChild(s),i.appendChild(d),i}(t,c.get());n.appendChild(i)}))}(t),o(c.get())})),e.subscribe("currentProjectChanged",(function(e){c.set(e),o(e),t.classList.toggle("navBarActive")})),e.subscribe("requestDescriptionEdit",(function(e){const t=document.querySelector("#mainDescription");t.querySelector("p").remove(),t.appendChild(e)}))}(),i.addProject("test1","","1"),i.addProject("test2","adsoifhsduioghasfiuoghsdifhusidghsuighdsgushsaduighsuig","3"),i.addProject("test3","adsoifhsduioghasfiuoghsdifhusidghsuighdsgushsaduighsuig","2")})();