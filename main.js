(()=>{"use strict";const e=function(){const e={};function t(t){return void 0!==e[t]||(console.log(`PubSub says: "${t}" hasn't been published yet!`),!1)}return{subscribe:function(t,n){void 0===e[t]&&(e[t]=[]),e[t].push(n),console.log(e)},unsubscribe:function(n,i){if(!t(n)||!function(t,n){return!(e[t].indexOf(n)<0&&(console.log("PubSub says: no such handler found"),1))}(n,i))return;const s=e[n].indexOf(i);e[n].splice(s,1),console.log(e)},publish:function(n,i){t(n)&&e[n].forEach((e=>e(i)))}}}(),t=(e,t)=>{const n={name:e,date:t,isDone:!1,id:`taskID${Math.floor(999999*Math.random())}`},i={done(){this.isDone=!0},notDone(){this.isDone=!1},edit(e,t){this.name=e,this.date=t}};return Object.assign(Object.create(i),n)},n=(e,n,i)=>{const s={title:e,description:n,priority:i,completed:!1,id:`projID${Math.floor(999999*Math.random())}`,tasks:[t("test","domani"),t("test2","dopo domani")]},d={pushTask(e){this.tasks.push(e)},deleteTask(e){const t=this.tasks.indexOf(e);this.tasks.splice(t,1)},edit(e,t,n){this.title=e,this.description=t,this.priority=n},getTasks(){return this.tasks},checkCompleted(){const e=tasks.sort((e=>e.isDone));tasks.lenght===e.lenght&&(this.completed=!0)}};return Object.assign(Object.create(d),s)},i=function(){const t=[];function i(e){for(let n=0;n<t.length;n++)if(t[n].id===e)return n}function s(e,t){for(let n=0;n<e.tasks.length;n++)if(e.tasks[n].id===t)return n}function d(i){const s=n(i,"","");t.push(s),e.publish("todoDataChanged",t)}return e.subscribe("addProject",d),e.subscribe("deleteProject",(function(n){const s=i(n);t.splice(s,1),e.publish("todoDataChanged",t)})),e.subscribe("deleteTask",(function(n){const d=s(n.project,n.id),a=i(n.project.id);t[a].tasks.splice(d,1),e.publish("todoDataChanged",t)})),e.subscribe("completeTask",(function(n){const d=i(n.projId),a=s(t[d],n.taskId);t[d].tasks[a].done(),e.publish("todoDataChanged",t)})),e.subscribe("incompleteTask",(function(n){const d=i(n.projId),a=s(t[d],n.taskId);t[d].tasks[a].notDone(),e.publish("todoDataChanged",t)})),e.subscribe("editProject",(function(n){const s=i(n.projId);t[s].edit(n.title,n.description,n.priority),e.publish("todoDataChanged",t)})),e.subscribe("editTask",(function(n){const d=i(n.project.id),a=s(n.project,n.taskId);t[d].tasks[a].edit(n.name,n.date),e.publish("todoDataChanged",t)})),{addProject:d}}();function s(t,n){const i=document.createElement("form"),s=document.createElement("input"),d=document.createElement("input"),a=document.createElement("span"),c=document.createElement("span");return s.setAttribute("type","text"),s.setAttribute("required",""),s.setAttribute("name","name"),s.setAttribute("value",n.name),d.setAttribute("type","date"),d.setAttribute("required",""),d.setAttribute("name","date"),d.setAttribute("value",n.date),i.setAttribute("method","dialog"),a.classList.add("material-icons"),c.classList.add("material-icons"),a.innerText="done",c.innerText="cancel",a.addEventListener("click",(()=>{s.checkValidity()&&d.checkValidity()&&e.publish("editTask",{project:t,taskId:n.id,name:s.value,date:d.value})})),c.addEventListener("click",(()=>{e.publish("editTask",{project:t,taskId:n.id,name:n.name,date:n.date})})),i.appendChild(s),i.appendChild(d),i.appendChild(a),i.appendChild(c),i}!function(){const t=document.querySelector("nav"),n=document.querySelector("#navProjectsContainer"),i=document.querySelector("main"),d=document.querySelector("header > button"),a=document.querySelector("#addProject"),c=document.querySelector("nav > form"),r={data:null,set(e){this.data=e},get(){return this.data}};function o(t){if(!t)return;i.innerHTML="";const n=function(t){const n=document.createElement("div"),i=document.createElement("h2"),s=document.createElement("div"),d=document.createElement("span"),a=document.createElement("span");return n.id="mainHeader",s.id="mainButtons",d.classList.add("material-icons"),a.classList.add("material-icons"),i.innerText=t.title,d.innerText="delete",a.innerText="edit",a.addEventListener("click",(()=>{e.publish("requestTitleEdit",function(t){const n=document.createElement("form"),i=document.createElement("input"),s=document.createElement("span"),d=document.createElement("span");return i.setAttribute("type","text"),i.setAttribute("required",""),i.setAttribute("name","title"),i.setAttribute("value",t.title),n.setAttribute("method","dialog"),s.classList.add("material-icons"),d.classList.add("material-icons"),s.innerText="done",d.innerText="cancel",s.addEventListener("click",(()=>{i.checkValidity()&&e.publish("editProject",{projId:t.id,title:i.value,description:t.value,priority:t.value})})),d.addEventListener("click",(()=>{e.publish("editProject",{projId:t.id,title:t.title,description:t.description,priority:t.value})})),n.appendChild(i),n.appendChild(s),n.appendChild(d),n}(t))})),d.addEventListener("click",(()=>{e.publish("deleteProject",t.id)})),s.appendChild(d),s.appendChild(a),n.appendChild(i),n.appendChild(s),n}(t),d=function(t){const n=document.createElement("div"),i=document.createElement("h3"),s=document.createElement("p");return n.id="mainDescription",i.innerText="Description",""===t.description?s.innerText="Write your description here!":s.innerText=t.description,s.addEventListener("click",(()=>{e.publish("requestDescriptionEdit",function(t){const n=document.createElement("form"),i=document.createElement("textarea"),s=document.createElement("span"),d=document.createElement("span");return i.setAttribute("type","text"),i.innerText=t.description,n.setAttribute("method","dialog"),s.classList.add("material-icons"),d.classList.add("material-icons"),s.innerText="done",d.innerText="cancel",s.addEventListener("click",(()=>{e.publish("editProject",{projId:t.id,title:t.title,description:i.value,priority:t.value})})),d.addEventListener("click",(()=>{e.publish("editProject",{projId:t.id,title:t.title,description:t.description,priority:t.value})})),n.appendChild(i),n.appendChild(s),n.appendChild(d),n}(t))})),n.appendChild(i),n.appendChild(s),n}(t),a=function(t){const n=document.createElement("div"),i=document.createElement("h3"),d=document.createElement("div");return n.id="mainTasks",i.innerText="Tasks",d.id="tasksContainer",d.classList.add("taskContainer"),d.innerHTML="",t.tasks.forEach((n=>{d.appendChild(function(t,n){const i=document.createElement("div"),d=document.createElement("div"),a=document.createElement("p"),c=document.createElement("p"),r=document.createElement("span"),o=document.createElement("span");return i.classList.add("task"),i.id=n.id,d.classList.add("taskContent"),a.classList.add("taskTitle"),c.classList.add("taskDate"),r.classList.add("material-icons"),o.classList.add("material-icons"),n.isDone?(i.classList.add("taskCompleted"),o.innerText="close",o.addEventListener("click",(()=>{e.publish("incompleteTask",{projId:t.id,taskId:n.id})}))):(o.innerText="done",i.classList.remove("taskCompleted"),o.addEventListener("click",(()=>{e.publish("completeTask",{projId:t.id,taskId:n.id})}))),r.addEventListener("click",(()=>{e.publish("deleteTask",{project:t,id:n.id})})),a.innerText=n.name,c.innerText=n.date,r.innerText="delete",d.addEventListener("click",(()=>{e.publish("requestTaskEdit",{taskId:n.id,form:s(t,n)})})),d.appendChild(a),d.appendChild(c),i.appendChild(o),i.appendChild(d),i.appendChild(r),i}(t,n))})),n.appendChild(i),n.appendChild(d),n}(t);i.appendChild(n),i.appendChild(d),i.appendChild(a)}d.addEventListener("click",(()=>{t.classList.toggle("navBarActive")})),a.addEventListener("click",(()=>{c.classList.add("formActive")}));const l=document.querySelector("nav > form > input"),u=document.querySelector("#projFormButtons > .confirm"),p=document.querySelector("#projFormButtons > .cancel");u.addEventListener("mousedown",(()=>{e.publish("addProject",l.value),c.reset(),c.classList.remove("formActive")})),p.addEventListener("click",(()=>{c.classList.remove("formActive")})),e.subscribe("todoDataChanged",(function(t){!function(t){n.innerHTML="",t.forEach((t=>{const i=function(t,n){const i=document.createElement("div"),s=document.createElement("p"),d=document.createElement("span");return i.classList.add("projectNav"),s.classList.add("projectNavTitle"),d.classList.add("material-icons"),d.addEventListener("click",(()=>{e.publish("deleteProject",t.id)})),n&&n.id===t.id&&i.classList.add("projectNavActive"),i.addEventListener("click",(()=>{!function(){const e=document.querySelector(".projectNavActive");null!==e&&e.classList.remove("projectNavActive")}(),i.classList.add("projectNavActive"),e.publish("currentProjectChanged",t)})),s.innerText=t.title,d.innerText="delete",i.id=t.id,i.appendChild(s),i.appendChild(d),i}(t,r.get());n.appendChild(i)}))}(t),o(r.get())})),e.subscribe("currentProjectChanged",(function(e){r.set(e),o(e),t.classList.toggle("navBarActive")})),e.subscribe("requestDescriptionEdit",(function(e){const t=document.querySelector("#mainDescription");t.querySelector("p").remove(),t.appendChild(e)})),e.subscribe("requestTitleEdit",(function(e){const t=document.querySelector("#mainHeader");t.innerHTML="",t.appendChild(e)})),e.subscribe("requestTaskEdit",(function(e){const t=document.querySelector(`#${e.taskId}`);t.innerHTML="",t.appendChild(e.form)}))}(),i.addProject("test1","","1"),i.addProject("test2","adsoifhsduioghasfiuoghsdifhusidghsuighdsgushsaduighsuig","3"),i.addProject("test3","adsoifhsduioghasfiuoghsdifhusidghsuighdsgushsaduighsuig","2")})();